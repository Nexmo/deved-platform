{"_filedata":{"slug":"how-send-receive-sms-messages-with-node-js-azure-functions-dr"},"title":"How to Send and Receive SMS Messages With Node.js and Azure Functions","description":"","thumbnail":"https://www.nexmo.com/wp-content/uploads/2020/01/E_SMS-Messages_Azure_1200x600-1.jpg","author":154,"published":true,"published_at":"2020-01-29T18:37:14","tags":[1529,793,92],"body":"<p><em>This blog post is part of the <a href=\"http://aka.ms/applied-cloud-stories\">Applied Cloud Stories</a> initiative.</em></p>\n<p>Webhooks are ever-more popular in the API world, and Nexmo uses them for quite a few of our APIs. So I end up writing quite a few of them. Since I&#8217;m a Node.js fan, I used to do most of them with Express. It was a hassle to spin up a webserver and get that deployed somewhere, so I started looking for alternatives. Serverless kept popping up in my research as one of the good alternatives, so I thought I&#8217;d use <a href=\"https://azure.microsoft.com/en-gb/services/functions/\">Azure Functions</a> and Node.js to send and receive SMS messages.</p>\n<p>For SMS, I&#8217;m going to use the Nexmo <a href=\"https://developer.nexmo.com/messaging/sms/overview\">SMS API</a>, which allows you to send and receive a high volume of SMS anywhere in the world. Once you get your virtual phone number, you can use the API to manage outbound messages (‚Äúsending‚Äù) and inbound messages (‚Äúreceiving‚Äù).</p>\n<p>In this article, you will learn how to send and receive SMS messages with <a href=\"https://nodejs.org/\">Node.js</a> and an <a href=\"https://azure.microsoft.com/en-gb/services/functions/\">Azure Functions App</a>.</p>\n<p>The code for this tutorial can be found on <a href=\"https://github.com/nexmo-community/nexmo-azure-sms-send-receive\">GitHub</a>.</p>\n<h2>Prerequisites</h2>\n<p>Before you begin, make  sure you have:</p>\n<ul>\n<li>A <a href=\"https://dashboard.nexmo.com/sign-up\">Nexmo account</a></li>\n<li>An <a href=\"azure.microsoft.com/\">Azure account</a></li>\n<li><a href=\"https://nodejs.org/en/download/\">Node.js</a> installed on your machine</li>\n</ul>\n<h2>Set up an Azure Functions App</h2>\n<p>There are a few ways you can set up an Azure Functions App. I&#8217;ve chosen to do so from the <a href=\"https://portal.azure.com/#create/hub\">Azure Portal</a>.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/create-azure-function.gif\" alt=\"Create Azure Functions App\" /></p>\n<p>I&#8217;ve named it <code>send-receive-sms</code>, created a new resource for it, and chose Node.js as the runtime. I&#8217;ve chosen the defaults in terms of deployment, region, and plans.</p>\n<p>Once the deployment finishes (usually around 2 minutes), you can go to the newly created resource and create your first function. There is a wizard helping you through the process, and I&#8217;ve selected <a href=\"https://code.visualstudio.com/\">VS Code</a> as my development environment and &#8220;Direct publish&#8221; as my deployment method. That gave me a set of instructions on how to set up VS Code for Azure.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/function-quickstart.gif\" alt=\"Create Azure Function quickstart\" /></p>\n<p>Once I was done with the setup, I created my first function, an HTTP Trigger. I&#8217;ve called it <code>inbound</code>, but you can use any name you want. For the security mechanism, you have a few options that control the authorization level on the function. &#8220;Function&#8221; requires a function-based API key, &#8220;Admin&#8221; requires your master API key from Azure, and &#8220;Anonymous&#8221; doesn&#8217;t require an API key. I&#8217;ve chosen &#8220;Anonymous&#8221; as the security mechanism for it. That created a new file with a default template.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/function-template.gif\" alt=\"Create Azure Function template\" /></p>\n<h2>Receiving an SMS Message</h2>\n<h3>Create a Webhook Function</h3>\n<p>I&#8217;ve replaced the contents of the function to match the <a href=\"https://developer.nexmo.com/messaging/sms/code-snippets/receiving-an-sms/node\">Receive an SMS code snippet</a> we use on our developer portal. It combines the body and query parameters of a request and logs that to the console. It&#8217;s a simple Webhook you can use to receive SMS messages on the Nexmo platform.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd05d535712815052\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\n  module.exports = async function(context, req) {\n    const params = Object.assign(req.query, req.body);\n\n    if (params.text) {\n      context.log(\"SMS received\", params);\n    }\n\n    context.res = {};\n  };\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d535712815052-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d535712815052-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d535712815052-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d535712815052-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d535712815052-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d535712815052-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d535712815052-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d535712815052-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d535712815052-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d535712815052-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d535712815052-1\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">async </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d535712815052-2\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Object</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">assign</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d535712815052-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d535712815052-4\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d535712815052-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"SMS received\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d535712815052-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d535712815052-7\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d535712815052-8\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d535712815052-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d535712815052-10\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3>Deploy Function</h3>\n<p>Because Nexmo needs to be able to access a public URL, I&#8217;ve deployed my function with Azure. You can do so in VS Code. Once the deployment finishes, you&#8217;ll get back a live URL for your function, for example, mine is <code>https://send-receive-sms.azurewebsites.net/api/inbound</code>.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/deploy-function.gif\" alt=\"Deploy Azure Function\" /></p>\n<h3>Set Inbound URL</h3>\n<p>To receive a SMS message on the Nexmo platform, you have to own a Nexmo number. If you don&#8217;t have one, you can buy one in the <a href=\"https://dashboard.nexmo.com/buy-numbers\">Nexmo Dashboard</a>:</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/buy-number.gif\" alt=\"Buy Nexmo Phone Number\" /></p>\n<p>When a Nexmo phone number receives an SMS message, Nexmo will pass that message to a Webhook you have specified in the Nexmo dashboard. We&#8217;ll use our Azure Function as the receiving Webhook. To set up the webhook URL, go to the little gear icon next to <a href=\"https://dashboard.nexmo.com/your-numbers\">your phone numbers in the Nexmo Dashboard</a> and fill in the &#8220;Inbound Webhook URL&#8221; field with the URL you got after deploying the Azure function (mine was <code>https://send-receive-sms.azurewebsites.net/api/inbound</code>).</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/set-inbound-webhook.gif\" alt=\"Set Inbound Webhook URL on the Nexmo Dashboard\" /></p>\n<p>You can test it works by sending an SMS from your phone to your Nexmo phone number, and it will show up in the Azure function logs.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/azure-function-logs.png\" style=\"border: none\" /></p>\n<h2>Sending an SMS Message</h2>\n<p>I thought it would be nice if the Function did a little more than logging the SMS messages, so I&#8217;m going to make it respond to SMS messages as well, changing the message from text to emojis.</p>\n<p>I&#8217;m going to use the Nexmo Node.js SDK for sending the SMS message, so you&#8217;ll need to install it in the Azure function. The top-level folder for your function has a <code>package.json</code> file in it that gets installed with each deployment. So if you navigate to that folder in the Terminal and use <code>npm install nexmo</code>, that will give you access to the Nexmo SDK inside the Azure function.</p>\n<p>I&#8217;ve also updated the function to initialize the Nexmo SDK, convert the SMS message to emojis and then send it as an SMS back to the original sender.</p>\n<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->\r\n\r\n\t\t<div id=\"crayon-5e9c0bd05d539083958023\" class=\"crayon-syntax crayon-theme-nexmo-2018 crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-mouseover\" style=\" margin-top: 24px; margin-bottom: 24px; font-size: 14px !important; line-height: 22px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 14px !important;height: 21px !important; line-height: 21px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"Toggle Line Numbers\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"Toggle Line Wrap\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"Expand Code\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"Copy\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"Open Code In New Window\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 19.6px !important; line-height: 19.6px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 14px !important; line-height: 22px !important;\">\nmodule.exports = async function(context, req) {\n  const Nexmo = require(\"nexmo\");\n\n  const nexmo = new Nexmo({\n    apiKey: process.env[\"NEXMO_API_KEY\"],\n    apiSecret: process.env[\"NEXMO_API_SECRET\"]\n  });\n\n  const params = Object.assign(req.query, req.body);\n\n  if (params.text) {\n    var response = [];\n\n    // transform inbound SMS into emojis\n    for (let i = 0; i &lt; params.text.length; i++) {\n      const emoji = String.fromCodePoint(127715 + params.text.charCodeAt(i));\n      response.push(emoji);\n    }\n\n    // send SMS back with emojis\n    nexmo.message.sendSms(\n      params.to,\n      params.msisdn,\n      response.join(\"\"),\n      {\n        type: \"unicode\"\n      },\n      (err, responseData) =&gt; {\n        if (err) {\n          context.log(err);\n        } else {\n          if (responseData.messages[0][\"status\"] === \"0\") {\n            context.log(\"Message sent successfully.\");\n          } else {\n            context.log(\n              `Message failed with error: ${responseData.messages[0][\"error-text\"]}`\n            );\n          }\n        }\n      }\n    );\n  }\n\n  context.res = {};\n};\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 14px !important; line-height: 22px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5e9c0bd05d539083958023-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5e9c0bd05d539083958023-46\">46</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 14px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-1\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">async </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-2\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"nexmo\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-3\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-4\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Nexmo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-5\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">apiKey</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"NEXMO_API_KEY\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-6\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">apiSecret</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">env</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"NEXMO_API_SECRET\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-7\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-8\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-9\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Object</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">assign</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-10\">&nbsp;</div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-11\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-12\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-13\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-14\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// transform inbound SMS into emojis</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-15\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-16\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">emoji</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fromCodePoint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">127715</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">charCodeAt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-17\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">emoji</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-18\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-19\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-20\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-c\">// send SMS back with emojis</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-21\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">nexmo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendSms</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-22\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">to</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-23\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">msisdn</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-24\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-25\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-26\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unicode\"</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-27\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-28\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">responseData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-29\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-30\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">err</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-31\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-32\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">responseData</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"status\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-33\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Message sent successfully.\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-34\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-35\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-36\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">`</span><span class=\"crayon-e\">Message </span><span class=\"crayon-e\">failed </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">responseData</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"error-text\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-37\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-38\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-39\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-40\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-41\"><span class=\"crayon-h\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-42\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-43\">&nbsp;</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-44\"><span class=\"crayon-h\">&nbsp;&nbsp;</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5e9c0bd05d539083958023-45\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5e9c0bd05d539083958023-46\">&nbsp;</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<p>You&#8217;ll notice my code initializes the Nexmo SDK with <code>process.env[\"NEXMO_API_KEY\"]</code> and <code>process.env[\"NEXMO_API_SECRET\"]</code>. The Azure Function App has Application settings and I&#8217;ve added my <code>NEXMO_API_KEY</code> and <code>NEXMO_API_SECRET</code> in there, and those get updated with each deployment from my local machine. You can do so as well, or replace those values with your actual API key and secret. You can find those on the &#8220;Getting Started&#8221; page in the <a href=\"https://dashboard.nexmo.com/getting-started-guide\">Nexmo Dashboard</a>.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/add-env-variable.gif\" alt=\"Add Application Settings in Azure\" /></p>\n<p>The SDK method for sending an SMS, <code>nexmo.message.sendSms()</code>, takes the sender ID, the recipient phone number, the text message and options as parameters. I&#8217;ve added <code>{type: \"unicode\"}</code> in the options because I&#8217;m sending emojis. It also accepts a callback that gets called when the API request is done.</p>\n<p>The response data contains an array for all the messages that were sent, with information about their status. In most cases, it&#8217;s going to be one element in that array, but if the SMS was longer than 160 characters, it gets split into a multipart SMS, and then the array contains data about each part sent. If the status of the message is 0, the SMS was sent successfully, otherwise, the error data for the message is on the <code>error-text</code> property of the message.</p>\n<p>Because my text has an emoji in it, I&#8217;m setting the type <code>unicode</code> in the options object, otherwise, that emoji is going to be sent on the network as <code>?</code>.</p>\n<h3>Try It Out</h3>\n<p>Now send an SMS message from your phone to your Nexmo number. You should get back an SMS message converting your text characters to emojis. If you send <code>Hello World!</code> in the SMS, you should get back üå∑üçàüçõüçóüåÉüçêüçàüåÉüçóüçàüçëüçáüçàüçïüåë.</p>\n<p><img src=\"https://www.nexmo.com/wp-content/uploads/2020/01/sms-emoji.jpg\" alt=\"Received SMS message with Nexmo\" /></p>\n<p>I hope it worked and you&#8217;ve just learned how to send and receive SMS messages with the Nexmo APIs. Azure Functions and Node.js.</p>\n"}